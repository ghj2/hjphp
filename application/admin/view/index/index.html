<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<title>Admin</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="Live preview for Color Admin - Responsive Admin Template at WrapBootstrap" name="description" />
	<meta content="ghj" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<!--link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" /-->
	<link href="__STATIC__/adminassets/plugins/jquery-ui-1.10.4/jquery-ui.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/plugins/bootstrap-3.1.1/css/bootstrap.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/plugins/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/css/animate.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/css/style.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/css/style-responsive.css" rel="stylesheet" />
	<!-- ================== END BASE CSS STYLE ================== -->
	 <script src="__STATIC__/adminassets/js/behavior.js"></script>
     <script src="__STATIC__/adminassets/js/ga.js"></script>           

	<!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
	<link href="__STATIC__/adminassets/plugins/bootstrap-datepicker/css/datepicker.css" rel="stylesheet" />
	<link href="__STATIC__/adminassets/plugins/bootstrap-datepicker/css/datepicker3.css" rel="stylesheet" />
    <link href="__STATIC__/adminassets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />	
	<!-- ================== END PAGE LEVEL STYLE ================== -->
	<style type="text/css">.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}
	</style>

</head>
<body>
	<!-- begin #page-loader -->
	<div id="page-loader" class="fade in"><span class="spinner"></span></div>
	<!-- end #page-loader -->
	
	<!-- begin #page-container -->
	<div id="page-container" class="fade">
		{include file="header_sidebar"} 	
		
		<!-- begin #content -->
		<div id="content" class="content">
			<!-- begin breadcrumb -->
			<ol class="breadcrumb pull-right">
				<li><a href="javascript:;">首页</a></li>
				<li class="active"></li>
			</ol>
			<!-- end breadcrumb -->
			<!-- begin page-header -->
			<h1 class="page-header">首页 <small> Main Page </small></h1>
			<!-- end page-header -->
			
			<!-- begin row 顶部四个框-->
			<div class="row">
				<!-- begin col-3 -->
				<div class="col-md-3 col-sm-6">
					<div class="widget widget-state bg-purple">
						<div class="state-icon"><i class="fa fa-fighter-jet"></i></div>
						<div class="state-info">
							<h4>总访问量</h4>
							<p>{$data['visitnum']}</p>	
						</div>
						<div class="state-link">
							<a href="{:url('footprints/index')}">详情  <i class="fa fa-arrow-circle-o-right"></i></a>
						</div>
					</div>
				</div>
				<!-- end col-3 -->
				<!-- begin col-3 -->
				<div class="col-md-3 col-sm-6">
					<div class="widget widget-state bg-blue">
						<div class="state-icon"><i class="fa fa-users"></i></div>
						<div class="state-info">
							<h4>用户</h4>
							<p>{$data['usernum']}</p>	
						</div>
						<div class="state-link">
							<a href="{:url('user/index')}">详情  <i class="fa fa-arrow-circle-o-right"></i></a>
						</div>
					</div>
				</div>
				<!-- end col-3 -->
				<!-- begin col-3 -->
				<div class="col-md-3 col-sm-6">
					<div class="widget widget-state bg-green">
						<div class="state-icon"><i class="fa fa-file-o"></i></div>
						<div class="state-info">
							<h4>文章</h4>
							<p>{$data['articlenum']}</p>	
						</div>
						<div class="state-link">
							<a href="{:url('article/index')}">详情  <i class="fa fa-arrow-circle-o-right"></i></a>
						</div>
					</div>
				</div>
				<!-- end col-3 -->
				<!-- begin col-3 -->
				<div class="col-md-3 col-sm-6">
					<div class="widget widget-state bg-red">
						<div class="state-icon"><i class="fa fa-envelope"></i></div>
						<div class="state-info">
							<h4>留言</h4>
							<p>{$data['messagenum']}</p>	
						</div>
						<div class="state-link">
							<a href="{:url('message/index')}">详情  <i class="fa fa-arrow-circle-o-right"></i></a>
						</div>
					</div>
				</div>
				<!-- end col-3 -->
			</div>
			<!-- end row -->
			<!-- begin row -->
			<div class="row">
				<!-- begin col-8 左列-->
				<div class="col-md-8">
					<div class="panel panel-inverse">
                        <div class="panel-heading">
                            <h4 class="panel-title">个人介绍</h4>
                        </div>
						
						<!-- 头像上传ajax表单 -->
						<form method="post" action="{:url('Index/upload_img')}" id="form2_grjs" enctype="multipart/form-data">
							<input name="up_headpic_input" type="file" id="up_headpic_input_grjs" style="display:none;"/> 
						</form>

                        <form name="form1" id="form1_grjs" method="post" action="{:url('set_options')}">
                        <div class="panel-body">
                           
                           	<input type="hidden" value="grjs" name="type">
                            <input class="form-control" name="grjs_row1" id="grjs_row1" value="{$options['grjs_row1']}" placeholder="第一行" type="text">
                            <p></p>
                           
							<input class="form-control" name="grjs_row2" id="grjs_row2" value="{$options['grjs_row2']}" placeholder="第二行" type="text">
                            <p></p>

                           	<div class="input-group">
                                <span class="input-group-addon">头像</span>
                                <img src="{$options['grjs_pic']}" onerror="javascript:this.src='__STATIC__/images/avatar_plus.png'" id="up_headpic_grjs" style="height:100px;width:100px" onclick="start_upload('grjs');"> 
								<input type="hidden" name="grjs_pic" id="headpic_grjs" value="{$options['grjs_pic']}"/>
                            </div>
                            <p></p>
							
							<textarea class="form-control" name="grjs_intro" id="grjs_intro" placeholder="签名">{$options['grjs_intro']}</textarea>
                            <p></p>
							
							<button type="button" onclick="postform('grjs')" class="btn btn-sm btn-success">提交保存</button>
							
                        </div>
                    	</form>
                    </div>
					
					<div class="panel panel-inverse">
                        <div class="panel-heading">
                            <h4 class="panel-title">友情链接</h4>
                        </div>
                       
						
                        <form name="form1" id="form1_links" method="post" class="form-inline" action="{:url('set_options')}">
                        <div class="panel-body">
                        	<input type="hidden" name="type" value="links"/>
                        	{foreach name="options['friend_link']" item="item" key="key"}
                        	<div class="friend_link">
                        	<input class="form-control" name="link_index{$key}" id="index{$key}" value="{$item['index']}" placeholder="排序" type="text">
                        	<input class="form-control" name="link_title{$key}" id="title{$key}" value="{$item['title']}" placeholder="标题" type="text">
                            <input class="form-control" name="link_url{$key}" id="url{$key}" value="{$item['url']}" placeholder="链接" type="text"> 
                            <button type="button" name="del_link" class="btn btn-sm btn-danger"><i class="fa fa-minus"></i></button>
                            <p></p>
							</div>
							{/foreach}
							

                           	<button type="button" id="add_link" class="btn btn-sm btn-success"><i class="fa fa-plus"></i></button>
                           	<p></p>

							<button type="button" onclick="postform('links')" class="btn btn-sm btn-success">提交保存</button>
                        </div>
                    	</form>
                    </div>
					
				
				</div>
				<!-- end col-8 -->
				<!-- begin col-4 右列-->
				<div class="col-md-4">
					<div class="panel panel-inverse">
                        <div class="panel-heading">
                            <h4 class="panel-title">首页图片</h4>
                        </div>
						
						<!-- 头像上传ajax表单 -->
						<form method="post" action="{:url('Index/upload_img')}" id="form2_hp" enctype="multipart/form-data">
							<input name="up_headpic_input" type="file" id="up_headpic_input_hp" style="display:none;"/> 
						</form>
						<!-- /头像上传ajax表单 -->

                        <form name="form1" id="form1_hp" method="post" action="{:url('set_options')}">
                        <div class="panel-body">
                         	<input type="hidden" name="type" value="hp">
                           	<div class="input-group">
                                <span class="input-group-addon">首页图片</span>
                                <img src="{$options['homepage_pic']}" onerror="javascript:this.src='__STATIC__/images/avatar_plus.png'" id="up_headpic_hp" style="width:200px" onclick="start_upload('hp');"> 
								<input type="hidden" name="homepage_pic" id="headpic_hp" value="{$options['homepage_pic']}"/>
                            </div>
                            <p></p>

                            <input class="form-control" name="homepage_title" id="homepage_title" value="{$options['homepage_title']}" placeholder="图片标题" type="text">
                            <p></p>
                           
							<button type="button" onclick="postform('hp')" class="btn btn-sm btn-success">提交保存</button>
							
                        </div>
                    	</form>
                    </div>
					<div class="panel panel-inverse">
                        <div class="panel-heading">
                            <h4 class="panel-title">微信</h4>
                        </div>
						
						<!-- 头像上传ajax表单 -->
						<form method="post" action="{:url('Index/upload_img')}" id="form2_wx" enctype="multipart/form-data">
							<input name="up_headpic_input" type="file" id="up_headpic_input_wx" style="display:none;"/> 
						</form>
						<!-- /头像上传ajax表单 -->

                        <form name="form1" id="form1_wx" method="post" action="{:url('set_options')}">
                        <div class="panel-body">
                         	<input type="hidden" name="type" value="wx">
                           	<div class="input-group">
                                <span class="input-group-addon">二维码图片</span>
                                <img src="{$options['wechat_pic']}" onerror="javascript:this.src='__STATIC__/images/avatar_plus.png'" id="up_headpic_wx" style="height:100px;width:100px" onclick="start_upload('wx');"> 
								<input type="hidden" name="wechat_pic" id="headpic_wx" value="{$options['wechat_pic']}"/>
                            </div>
                            <p></p>

							<button type="button" onclick="postform('wx')" class="btn btn-sm btn-success">提交保存</button>
							
                        </div>
                    	</form>
                    </div>
					
					
				</div>
				<!-- end col-4 -->
			</div>
			<!-- end row -->





		</div>
		<!-- end #content -->
		
		<!-- begin scroll to top btn -->
		<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
		<!-- end scroll to top btn -->
	</div>
	<!-- end page container -->
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="__STATIC__/adminassets/plugins/jquery-1.7.2/jquery-1.7.2.js"></script>
	<script src="__STATIC__/adminassets/plugins/jquery-ui-1.10.4/ui/minified/jquery-ui.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/bootstrap-3.1.1/js/bootstrap.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	
	<!-- ================= BEGIN PAGE LEVEL JS ================== -->
	<!-- <script src="__STATIC__/adminassets/plugins/gritter/js/jquery.gritter.js"></script> -->
	<script src="__STATIC__/adminassets/plugins/flot/jquery.flot.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/flot/jquery.flot.time.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/flot/jquery.flot.resize.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/flot/jquery.flot.pie.min.js"></script>
	<script src="__STATIC__/adminassets/plugins/sparkline/jquery.sparkline.js"></script>
	<script src="__STATIC__/adminassets/plugins/jquery-jvectormap/jquery-jvectormap-1.2.2-min.js"></script>
	<script src="__STATIC__/adminassets/plugins/jquery-jvectormap/jquery-jvectormap-world-mill-en.js"></script>
	<script src="__STATIC__/adminassets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script src="__STATIC__/adminassets/js/dashboard.js"></script>
	<script src="__STATIC__/adminassets/js/apps.js"></script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	<script>
		$(document).ready(function() {
			App.init();
			Dashboard.init();
		});
	</script>
	
	<script src="__STATIC__/js/jquery.form.js"></script> 
	<script>
	function start_upload(type){
		$("#up_headpic_input_"+type).click();
	
		$("#up_headpic_input_"+type).change(function(){
			$("#form2_"+type).ajaxSubmit({
				dataType:  'json',
			    beforeSubmit:function(){},
				beforeSend: function() {},
				uploadProgress: function(event, position, total, percentComplete) {
	                var percentVal = percentComplete;
				},	
				success: function(data) {
					if(data == "图片上传失败:02"){
						alert(data);
					}else{
						$("#up_headpic_"+type).attr("src",data);
						$("#headpic_"+type).val(data);
					}
				},
				error:function(xhr){
					alert("图片传输失败:01");
				}
			}); 
		});
	}
	function postform(type){
		$("#form1_"+type).ajaxSubmit({
				dataType:  'json',
			    beforeSubmit:function(){},
				beforeSend: function() {},
				uploadProgress: function(event, position, total, percentComplete) {
	                var percentVal = percentComplete;
				},	
				success: function(data) {
					console.log(data);
				},
				error:function(xhr){
					console.log(xhr);
				}
			}); 
	}
	$("#add_link").click(function(){
		var last = $(this).prev();
		if(last.attr('name')!='type'){
			var id = parseInt(last.children(0).attr('id').replace(/[^0-9]/ig,""))+1;
		}else{
			var id = 0;
		}
		last.after("<div class='friend_link'>"+
            	"<input class='form-control' name='link_index"+id+"' id='index"+id+"' value='' placeholder='排序' type='text'>"+" "+
            	"<input class='form-control' name='link_title"+id+"' id='title"+id+"' value='' placeholder='标题' type='text'>"+" "+
                "<input class='form-control' name='link_url"+id+"' id='url"+id+"' value='' placeholder='链接' type='text'>"+" "+
                "<button type='button' name='del_link' class='btn btn-sm btn-danger'><i class='fa fa-minus'></i></button>"+
                "<p></p></div>");
	});
	$(document).on("click","[name='del_link']",function(){
		//索引
		$(this).parent().nextAll("div").each(function(){
	    	$(this).children("input").each(function(){
	    		var index = $(this).attr("id").replace(/[^0-9]/ig,"");
	    		var prefix1 = $(this).attr("id").replace(index,"");
	    		var prefix2 = $(this).attr("name").replace(index,"");
	    		$(this).attr("id",prefix1+(parseInt(index)-1));
	    		$(this).attr("name",prefix2+(parseInt(index)-1));
	    	});
	  	});
	  	//效果
		$(this).parent().remove();
	});
	
	</script>
	

</body>
</html>
